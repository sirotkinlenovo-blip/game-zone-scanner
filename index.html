<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GAME ZONE - –°–∫–∞–Ω–µ—Ä –∏–≥—Ä</title>
    <meta name="theme-color" content="#0078D7">
    <meta name="description" content="–°–∫–∞–Ω–µ—Ä –∏–≥—Ä–æ–≤—ã—Ö –¥–∏—Å–∫–æ–≤ –¥–ª—è –º–∞–≥–∞–∑–∏–Ω–∞ GAME ZONE">
    
    <!-- PWA –º–µ—Ç–∞-—Ç–µ–≥–∏ -->
    <link rel="manifest" href="manifest.json">
    <link rel="icon" type="image/png" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAFaSURBVHgB7Zc9TsNAEIXf2I6dQkFJQUVLRUNBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBAQDwDfAA1dUjFAAAAAElFTkSuQmCC">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="GAME ZONE">
    
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            overscroll-behavior-y: none;
        }
        .container {
            max-width: 400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            position: relative;
            z-index: 1;
        }
        .header { 
            text-align: center; 
            margin-bottom: 20px; 
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        .header h1 { 
            color: #333; 
            font-size: 24px; 
            margin-bottom: 5px;
        }
        .store-icon {
            width: 40px;
            height: 40px;
            border-radius: 8px;
            background: linear-gradient(45deg, #ff6b6b, #ffa726);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 18px;
        }
        .btn {
            width: 100%;
            padding: 15px;
            background: #0078D7;
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            margin: 10px 0;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .btn:active {
            transform: scale(0.98);
        }
        .btn:disabled {
            background: #6c757d;
            cursor: not-allowed;
        }
        .btn.sale {
            background: #28a745;
            font-weight: bold;
            font-size: 18px;
        }
        .btn.logs {
            background: #6c757d;
            font-size: 14px;
            padding: 10px;
        }
        
        #scanner-container {
            width: 100%;
            height: 200px;
            background: #f0f0f0;
            border-radius: 10px;
            margin: 15px 0;
            position: relative;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 2px dashed #ccc;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        #scanner-container:hover {
            border-color: #0078D7;
            background: #e8f4ff;
        }
        #scanner-container:active {
            transform: scale(0.98);
        }
        .scanner-placeholder {
            text-align: center;
            color: #666;
        }
        .scanner-placeholder .icon {
            font-size: 48px;
            margin-bottom: 10px;
        }
        .scanner-placeholder .text {
            font-size: 16px;
            font-weight: 500;
        }
        
        .search-container {
            display: flex;
            gap: 10px;
            margin: 10px 0;
        }
        #search-type {
            width: 100px;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 10px;
            font-size: 14px;
        }
        #barcode-input {
            flex: 1;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 10px;
            text-align: center;
            font-size: 16px;
        }
        
        .current-price {
            background: linear-gradient(135deg, #28a745, #20c997);
            color: white;
            text-align: center;
            padding: 15px;
            border-radius: 15px;
            margin: 15px 0;
            font-weight: bold;
            font-size: 20px;
            display: none;
            box-shadow: 0 4px 15px rgba(40, 167, 69, 0.3);
        }
        .current-price.visible { display: block; }
        
        .game-info {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 20px;
            margin-top: 20px;
            display: none;
        }
        .game-info.visible { display: block; }
        .info-row {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #eee;
        }
        .info-label { color: #666; font-weight: 500; min-width: 140px; }
        .info-value { color: #333; font-weight: 600; text-align: right; flex: 1; }
        .price-final {
            color: #0078D7;
            font-size: 20px;
            font-weight: bold;
            text-align: center;
            margin: 15px 0;
            padding: 15px;
            background: #e3f2fd;
            border-radius: 10px;
            border: 2px solid #0078D7;
        }
        .status {
            text-align: center;
            padding: 10px;
            margin: 10px 0;
            border-radius: 8px;
            background: #fff3cd;
            color: #856404;
        }
        .status.error {
            background: #f8d7da;
            color: #721c24;
        }
        .status.success {
            background: #d4edda;
            color: #155724;
        }
        
        #camera-modal {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 90%;
            max-width: 400px;
            background: white;
            border-radius: 20px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            z-index: 1000;
            display: none;
        }
        .camera-container {
            position: relative;
            width: 100%;
            height: 300px;
            background: black;
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 15px;
        }
        .camera-view {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        .camera-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border: 3px solid #0078D7;
            pointer-events: none;
        }
        .camera-line {
            position: absolute;
            width: 100%;
            height: 3px;
            background: #ff0000;
            animation: scan 2s infinite linear;
        }
        @keyframes scan {
            0%, 100% { top: 10%; }
            50% { top: 90%; }
        }
        .camera-controls {
            display: flex;
            gap: 10px;
        }
        .camera-btn {
            flex: 1;
            padding: 12px;
            background: #0078D7;
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .camera-btn:active {
            transform: scale(0.95);
        }
        .camera-btn.secondary {
            background: #6c757d;
        }
        .camera-btn.restart {
            background: #ffc107;
            color: #000;
        }
        .camera-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        
        #modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            z-index: 999;
            display: none;
        }
        
        .scanning-status {
            text-align: center;
            padding: 8px;
            margin: 5px 0;
            border-radius: 5px;
            font-size: 14px;
        }
        .scanning-success {
            background: #d4edda;
            color: #155724;
        }
        .scanning-error {
            background: #f8d7da;
            color: #721c24;
        }
        
        .summary-section {
            margin-top: 20px;
            display: none;
        }
        .summary-section.visible { display: block; }
        .summary-header {
            text-align: center;
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 15px;
            color: #333;
        }
        .scanned-games-list {
            max-height: 200px;
            overflow-y: auto;
            margin-bottom: 15px;
            border: 1px solid #ddd;
            border-radius: 10px;
            padding: 10px;
        }
        
        .scanned-game-item {
            display: flex;
            align-items: center;
            padding: 12px 8px;
            border-bottom: 1px solid #eee;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }
        .scanned-game-item:hover {
            background-color: #f8f9fa;
        }
        .scanned-game-item.removing {
            background-color: #ffe6e6;
            text-decoration: line-through;
        }
        
        .remove-icon {
            width: 24px;
            height: 24px;
            background: #dc3545;
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            font-weight: bold;
            margin-right: 10px;
            cursor: pointer;
            flex-shrink: 0;
            transition: all 0.3s ease;
        }
        .remove-icon:hover {
            background: #c82333;
            transform: scale(1.1);
        }
        
        .game-number {
            color: #666;
            min-width: 25px;
            font-weight: bold;
        }
        .game-name {
            flex: 1;
            text-align: left;
            padding: 0 10px;
            font-weight: 500;
        }
        .game-quantity {
            display: flex;
            align-items: center;
            margin: 0 10px;
        }
        .quantity-btn {
            width: 24px;
            height: 24px;
            background: #0078D7;
            color: white;
            border: none;
            border-radius: 50%;
            cursor: pointer;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .quantity-value {
            min-width: 20px;
            text-align: center;
            font-weight: bold;
        }
        .game-price {
            color: #0078D7;
            font-weight: bold;
            min-width: 70px;
            text-align: right;
        }
        
        .total-sum {
            text-align: center;
            font-size: 20px;
            font-weight: bold;
            color: #28a745;
            padding: 15px;
            background: #f8fff9;
            border-radius: 10px;
            border: 2px solid #28a745;
            margin: 10px 0;
        }
        .summary-buttons {
            display: flex;
            gap: 10px;
        }
        .summary-btn {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 10px;
            font-size: 14px;
            cursor: pointer;
        }
        .reset-btn {
            background: #dc3545;
            color: white;
        }
        .summary-main-btn {
            background: #28a745;
            color: white;
        }

        /* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ª–æ–≥–æ–≤ */
        #logs-modal {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 90%;
            max-width: 400px;
            max-height: 80vh;
            background: white;
            border-radius: 20px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            z-index: 1002;
            display: none;
            overflow: hidden;
        }
        .logs-header {
            text-align: center;
            margin-bottom: 15px;
            font-size: 18px;
            font-weight: bold;
            color: #333;
        }
        .logs-content {
            max-height: 50vh;
            overflow-y: auto;
            margin-bottom: 15px;
            border: 1px solid #ddd;
            border-radius: 10px;
            padding: 10px;
            background: #f8f9fa;
            font-family: monospace;
            font-size: 12px;
            white-space: pre-wrap;
            word-break: break-all;
        }
        .logs-buttons {
            display: flex;
            gap: 10px;
        }
        .logs-tabs {
            display: flex;
            margin-bottom: 15px;
            border-bottom: 1px solid #ddd;
        }
        .logs-tab {
            flex: 1;
            padding: 10px;
            text-align: center;
            cursor: pointer;
            border-bottom: 2px solid transparent;
        }
        .logs-tab.active {
            border-bottom: 2px solid #0078D7;
            font-weight: bold;
            color: #0078D7;
        }

        .app-version {
            text-align: center;
            margin-top: 20px;
            font-size: 12px;
            color: #666;
            padding: 10px;
            border-top: 1px solid #eee;
        }

        .platform-icon {
            display: inline-block;
            width: 20px;
            height: 20px;
            margin-right: 5px;
            vertical-align: middle;
            border-radius: 3px;
            color: white;
            font-size: 10px;
            text-align: center;
            line-height: 20px;
            font-weight: bold;
        }
        .ps4-icon { background-color: #0070d1; }
        .ps5-icon { background-color: #000; }
        .ns-icon { background-color: #e60012; }
        .xbox-icon { background-color: #107c10; }

        .install-prompt {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: #333;
            color: white;
            padding: 15px 20px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            z-index: 1001;
            display: none;
            max-width: 90%;
            text-align: center;
        }
        .install-prompt button {
            background: #0078D7;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            margin-left: 10px;
            cursor: pointer;
        }
        
        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid #f3f3f3;
            border-top: 2px solid #0078D7;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 10px;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è –ø–æ–∏—Å–∫–∞ */
        .search-results {
            position: absolute;
            width: calc(100% - 100px);
            background: white;
            border: 1px solid #ddd;
            border-radius: 10px;
            max-height: 200px;
            overflow-y: auto;
            z-index: 10;
            display: none;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            margin-top: 5px;
        }
        .search-result-item {
            padding: 10px;
            border-bottom: 1px solid #eee;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        .search-result-item:hover {
            background-color: #f8f9fa;
        }
        .search-result-item:last-child {
            border-bottom: none;
        }
        .search-result-name {
            font-weight: bold;
            margin-bottom: 3px;
        }
        .search-result-info {
            font-size: 12px;
            color: #666;
            display: flex;
            justify-content: space-between;
        }
    </style>
</head>
<body>
    <!-- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ–± —É—Å—Ç–∞–Ω–æ–≤–∫–µ -->
    <div id="install-prompt" class="install-prompt">
        –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ GAME ZONE –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞!
        <button id="install-btn">–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å</button>
        <button id="dismiss-install" style="background: #6c757d;">–ü–æ–∑–∂–µ</button>
    </div>

    <div class="container">
        <div class="header">
            <div class="store-icon">GZ</div>
            <div>
                <h1>GAME ZONE</h1>
                <p>–°–∫–∞–Ω–µ—Ä –∏–≥—Ä–æ–≤—ã—Ö –¥–∏—Å–∫–æ–≤</p>
            </div>
        </div>

        <div id="current-price" class="current-price">
            üí∞ –¶–µ–Ω–∞: <span id="current-price-value">0</span> —Ä—É–±
        </div>

        <div id="scanner-container">
            <div class="scanner-placeholder">
                <div class="icon">üì∑</div>
                <div class="text">–ù–∞–∂–º–∏—Ç–µ –¥–ª—è –∑–∞–ø—É—Å–∫–∞ —Å–∫–∞–Ω–µ—Ä–∞</div>
            </div>
        </div>

        <div class="search-container">
            <select id="search-type" class="search-type">
                <option value="barcode">–®—Ç—Ä–∏—Ö-–∫–æ–¥</option>
                <option value="cusa">CUSA/PPSA</option>
                <option value="name">–ù–∞–∑–≤–∞–Ω–∏–µ</option>
            </select>
            <input type="text" id="barcode-input" placeholder="–í–≤–µ–¥–∏—Ç–µ –¥–ª—è –ø–æ–∏—Å–∫–∞...">
            <div id="search-results" class="search-results"></div>
        </div>
        <button id="search-btn" class="btn">üîç –ù–∞–π—Ç–∏ –∏–≥—Ä—É</button>

        <button id="summary-btn" class="btn" style="background: #28a745;">üí∞ –ò–¢–û–ì–û</button>

        <!-- –ö–ù–û–ü–ö–ê –ü–†–û–î–ê–ñ–ò -->
        <button id="sale-btn" class="btn sale">üí∞ –û–§–û–†–ú–ò–¢–¨ –ü–†–û–î–ê–ñ–£</button>

        <!-- –ö–ù–û–ü–ö–ê –ü–†–û–°–ú–û–¢–†–ê –õ–û–ì–û–í -->
        <button id="logs-btn" class="btn logs">üìÅ –ü–†–û–°–ú–û–¢–† –õ–û–ì–û–í</button>

        <div id="scanning-status" class="scanning-status" style="display: none;"></div>

        <div id="status" class="status">
            <div class="loading-spinner"></div>
            <span id="status-text">–ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ...</span>
        </div>

        <div id="game-info" class="game-info">
            <div class="price-final">
                üí∞ –¶–µ–Ω–∞ –ø—Ä–æ–¥–∞–∂–∏: <span id="game-final-price"></span> —Ä—É–±
            </div>
            
            <div class="info-row">
                <span class="info-label">–ù–∞–∑–≤–∞–Ω–∏–µ –∏–≥—Ä—ã:</span>
                <span class="info-value" id="game-name"></span>
            </div>
            
            <div class="info-row">
                <span class="info-label">–Ø–∑—ã–∫ –∏–≥—Ä—ã:</span>
                <span class="info-value" id="game-language"></span>
            </div>
            
            <div class="info-row">
                <span class="info-label">–ü–ª–∞—Ç—Ñ–æ—Ä–º–∞:</span>
                <span class="info-value" id="game-platform"></span>
            </div>
            <div class="info-row" id="game-code-row">
                <span class="info-label" id="game-code-label">CUSA:</span>
                <span class="info-value" id="game-code"></span>
            </div>
            <div class="info-row">
                <span class="info-label">–®—Ç—Ä–∏—Ö-–∫–æ–¥:</span>
                <span class="info-value" id="game-barcode"></span>
            </div>
            <div class="info-row">
                <span class="info-label">–¶–µ–Ω–∞ –≤ –ú–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å–µ:</span>
                <span class="info-value" id="game-marketplace"></span>
            </div>
        </div>

        <div id="summary-section" class="summary-section">
            <div class="summary-header">üìä –û—Ç—Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∏–≥—Ä—ã</div>
            <div style="text-align: center; margin-bottom: 10px; font-size: 12px; color: #666;">
                üí° –ù–∞–∂–º–∏—Ç–µ –Ω–∞ –∏–≥—Ä—É –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏<br>
                ‚ùå –ù–∞–∂–º–∏—Ç–µ –Ω–∞ –∫—Ä–µ—Å—Ç–∏–∫ –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è<br>
                üî¢ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ +/- –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞
            </div>
            
            <div id="scanned-games-list" class="scanned-games-list"></div>
            
            <div class="total-sum">
                –û–±—â–∞—è —Å—É–º–º–∞: <span id="total-amount">0</span> —Ä—É–±
            </div>
            
            <div class="summary-buttons">
                <button id="reset-scans-btn" class="summary-btn reset-btn">üîÑ –°–±—Ä–æ—Å–∏—Ç—å –≤—Å–µ</button>
                <button id="close-summary-btn" class="summary-btn summary-main-btn">‚úñ –ó–∞–∫—Ä—ã—Ç—å</button>
            </div>
        </div>

        <div class="app-version">
            –í–µ—Ä—Å–∏—è 4.1 | GAME ZONE PWA | <span id="cache-status">‚úÖ</span>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∫–∞–º–µ—Ä—ã -->
    <div id="modal-overlay"></div>
    <div id="camera-modal">
        <div class="camera-container">
            <video id="camera-view" class="camera-view" autoplay playsinline></video>
            <div class="camera-overlay">
                <div class="camera-line"></div>
            </div>
        </div>
        <div class="camera-controls">
            <button id="restart-camera" class="camera-btn restart">üîÑ –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –∫–∞–º–µ—Ä—É</button>
            <button id="close-camera" class="camera-btn secondary">‚ùå –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å</button>
        </div>
        <div id="camera-status" class="scanning-status" style="margin-top: 10px;"></div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ª–æ–≥–æ–≤ -->
    <div id="logs-modal">
        <div class="logs-header">üìÅ –°–ò–°–¢–ï–ú–ê –õ–û–ì–ì–ò–†–û–í–ê–ù–ò–Ø</div>
        
        <div class="logs-tabs">
            <div class="logs-tab active" data-tab="app">üìù –õ–æ–≥ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è</div>
            <div class="logs-tab" data-tab="sales">üí∞ –õ–æ–≥ –ø—Ä–æ–¥–∞–∂</div>
            <div class="logs-tab" data-tab="today">üìÖ –°–µ–≥–æ–¥–Ω—è</div>
        </div>
        
        <div id="logs-content" class="logs-content">
            –ó–∞–≥—Ä—É–∑–∫–∞ –ª–æ–≥–æ–≤...
        </div>
        
        <div class="logs-buttons">
            <button id="export-logs-btn" class="summary-btn" style="background: #0078D7;">üì§ –≠–∫—Å–ø–æ—Ä—Ç</button>
            <button id="clear-logs-btn" class="summary-btn reset-btn">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å</button>
            <button id="close-logs-btn" class="summary-btn summary-main-btn">‚úñ –ó–∞–∫—Ä—ã—Ç—å</button>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@ericblade/quagga2@1.8.1/dist/quagga.min.js"></script>
    
    <script>
        // –ö–ª–∞—Å—Å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º–æ–π (File System Access API)
        class FileSystemManager {
            constructor() {
                this.appLogFileHandle = null;
                this.salesLogFileHandle = null;
                this.directoryHandle = null;
                this.supported = 'showDirectoryPicker' in window;
            }

            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã
            async init() {
                if (!this.supported) {
                    console.log('‚ö†Ô∏è File System Access API –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è');
                    return false;
                }

                try {
                    // –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ –Ω–∞ –¥–æ—Å—Ç—É–ø –∫ –ø–∞–ø–∫–µ
                    this.directoryHandle = await window.showDirectoryPicker({
                        id: 'gameZoneLogs',
                        startIn: 'documents',
                        mode: 'readwrite'
                    });
                    
                    console.log('‚úÖ –î–æ—Å—Ç—É–ø –∫ —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º–µ –ø–æ–ª—É—á–µ–Ω');
                    return true;
                } catch (error) {
                    console.log('‚ö†Ô∏è –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–º–µ–Ω–∏–ª –¥–æ—Å—Ç—É–ø –∫ —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º–µ:', error);
                    return false;
                }
            }

            // –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–ª–∏ —Å–æ–∑–¥–∞–Ω–∏–µ —Ñ–∞–π–ª–∞ –ª–æ–≥–∞
            async getLogFileHandle(fileName) {
                if (!this.directoryHandle) return null;

                try {
                    // –ü—Ä–æ–±—É–µ–º –ø–æ–ª—É—á–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π —Ñ–∞–π–ª
                    const fileHandle = await this.directoryHandle.getFileHandle(fileName, { create: true });
                    return fileHandle;
                } catch (error) {
                    console.error('‚ùå –û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è —Ñ–∞–π–ª–∞:', error);
                    return null;
                }
            }

            // –ß—Ç–µ–Ω–∏–µ —Ñ–∞–π–ª–∞
            async readFile(fileHandle) {
                try {
                    const file = await fileHandle.getFile();
                    const content = await file.text();
                    return content;
                } catch (error) {
                    console.error('‚ùå –û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è —Ñ–∞–π–ª–∞:', error);
                    return '';
                }
            }

            // –ó–∞–ø–∏—Å—å –≤ —Ñ–∞–π–ª (–¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ –∫–æ–Ω–µ—Ü)
            async appendToFile(fileHandle, text) {
                try {
                    // –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â–µ–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ
                    const currentContent = await this.readFile(fileHandle);
                    
                    // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç
                    const newContent = currentContent + text;
                    
                    // –ó–∞–ø–∏—Å—ã–≤–∞–µ–º –æ–±—Ä–∞—Ç–Ω–æ
                    const writable = await fileHandle.createWritable();
                    await writable.write(newContent);
                    await writable.close();
                    
                    console.log(`‚úÖ –î–∞–Ω–Ω—ã–µ –∑–∞–ø–∏—Å–∞–Ω—ã –≤ —Ñ–∞–π–ª: ${fileHandle.name}`);
                    return true;
                } catch (error) {
                    console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–ø–∏—Å–∏ –≤ —Ñ–∞–π–ª:', error);
                    return false;
                }
            }

            // –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —Ñ–∞–π–ª–∞ —Å –Ω–∞—á–∞–ª—å–Ω—ã–º —Å–æ–¥–µ—Ä–∂–∏–º—ã–º
            async createFile(fileName, initialContent = '') {
                if (!this.directoryHandle) return null;

                try {
                    const fileHandle = await this.directoryHandle.getFileHandle(fileName, { create: true });
                    
                    if (initialContent) {
                        await this.writeFile(fileHandle, initialContent);
                    }
                    
                    return fileHandle;
                } catch (error) {
                    console.error('‚ùå –û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è —Ñ–∞–π–ª–∞:', error);
                    return null;
                }
            }

            // –ü–æ–ª–Ω–∞—è –ø–µ—Ä–µ–∑–∞–ø–∏—Å—å —Ñ–∞–π–ª–∞
            async writeFile(fileHandle, content) {
                try {
                    const writable = await fileHandle.createWritable();
                    await writable.write(content);
                    await writable.close();
                    return true;
                } catch (error) {
                    console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–ø–∏—Å–∏ —Ñ–∞–π–ª–∞:', error);
                    return false;
                }
            }

            // –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ —Ñ–∞–π–ª–æ–≤ –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
            async listFiles() {
                if (!this.directoryHandle) return [];

                const files = [];
                for await (const [name, handle] of this.directoryHandle.entries()) {
                    if (handle.kind === 'file') {
                        files.push({
                            name: name,
                            handle: handle
                        });
                    }
                }
                return files;
            }

            // –°–∫–∞—á–∏–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–∞
            downloadFile(filename, content) {
                try {
                    const element = document.createElement('a');
                    element.setAttribute('href', 'data:text/plain;charset=utf-8,' + encodeURIComponent(content));
                    element.setAttribute('download', filename);
                    element.style.display = 'none';
                    document.body.appendChild(element);
                    element.click();
                    document.body.removeChild(element);
                    return true;
                } catch (error) {
                    console.error('‚ùå –û—à–∏–±–∫–∞ —Å–∫–∞—á–∏–≤–∞–Ω–∏—è —Ñ–∞–π–ª–∞:', error);
                    return false;
                }
            }
        }

        // –ö–ª–∞—Å—Å –¥–ª—è –ª–æ–≥–≥–∏—Ä–æ–≤–∞–Ω–∏—è —Å —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º–æ–π
        class EnhancedLogger {
            constructor() {
                this.fileSystem = new FileSystemManager();
                this.appLog = [];
                this.salesLog = [];
                this.maxLogSize = 1000;
                this.fileSystemEnabled = false;
                
                // –ò–º–µ–Ω–∞ —Ñ–∞–π–ª–æ–≤
                this.APP_LOG_FILE = 'gamezone_app_log.txt';
                this.SALES_LOG_FILE = 'gamezone_sales_log.txt';
                this.TODAY_SALES_FILE = 'gamezone_today_sales.txt';
            }

            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
            async init() {
                // –ó–∞–≥—Ä—É–∂–∞–µ–º –∏–∑ localStorage –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
                this.loadFromLocalStorage();
                
                // –ü—Ä–æ–±—É–µ–º –≤–∫–ª—é—á–∏—Ç—å —Ñ–∞–π–ª–æ–≤—É—é —Å–∏—Å—Ç–µ–º—É
                this.fileSystemEnabled = await this.fileSystem.init();
                
                if (this.fileSystemEnabled) {
                    console.log('‚úÖ –§–∞–π–ª–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞ –≤–∫–ª—é—á–µ–Ω–∞');
                    
                    // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ —Ñ–∞–π–ª–æ–≤
                    await this.loadFromFiles();
                } else {
                    console.log('‚ö†Ô∏è –§–∞–π–ª–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞, –∏—Å–ø–æ–ª—å–∑—É–µ–º localStorage');
                }
            }

            // –ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑ —Ñ–∞–π–ª–æ–≤
            async loadFromFiles() {
                try {
                    // –ó–∞–≥—Ä—É–∂–∞–µ–º –ª–æ–≥ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
                    const appLogFile = await this.fileSystem.getLogFileHandle(this.APP_LOG_FILE);
                    if (appLogFile) {
                        const appLogContent = await this.fileSystem.readFile(appLogFile);
                        if (appLogContent) {
                            // –ü–∞—Ä—Å–∏–º —Å—Ç—Ä–æ–∫–∏ –ª–æ–≥–∞
                            const lines = appLogContent.split('\n').filter(line => line.trim());
                            this.appLog = lines.map(line => {
                                try {
                                    return JSON.parse(line);
                                } catch {
                                    return { raw: line };
                                }
                            });
                        }
                    }

                    // –ó–∞–≥—Ä—É–∂–∞–µ–º –ª–æ–≥ –ø—Ä–æ–¥–∞–∂
                    const salesLogFile = await this.fileSystem.getLogFileHandle(this.SALES_LOG_FILE);
                    if (salesLogFile) {
                        const salesLogContent = await this.fileSystem.readFile(salesLogFile);
                        if (salesLogContent) {
                            const lines = salesLogContent.split('\n').filter(line => line.trim());
                            this.salesLog = lines.map(line => {
                                try {
                                    return JSON.parse(line);
                                } catch {
                                    return { raw: line };
                                }
                            });
                        }
                    }
                    
                    console.log(`üìä –ó–∞–≥—Ä—É–∂–µ–Ω–æ –∏–∑ —Ñ–∞–π–ª–æ–≤: –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ - ${this.appLog.length}, –ü—Ä–æ–¥–∞–∂–∏ - ${this.salesLog.length}`);
                } catch (error) {
                    console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑ —Ñ–∞–π–ª–æ–≤:', error);
                }
            }

            // –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
            async logAppAction(action, details = {}) {
                const logEntry = {
                    timestamp: new Date().toISOString(),
                    action: action,
                    details: details
                };
                
                // –î–æ–±–∞–≤–ª—è–µ–º –≤ –ø–∞–º—è—Ç—å
                this.appLog.push(logEntry);
                if (this.appLog.length > this.maxLogSize) {
                    this.appLog = this.appLog.slice(-this.maxLogSize);
                }
                
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ localStorage
                this.saveToLocalStorage();
                
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ —Ñ–∞–π–ª –µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–Ω–æ
                if (this.fileSystemEnabled) {
                    const logLine = JSON.stringify(logEntry) + '\n';
                    const fileHandle = await this.fileSystem.getLogFileHandle(this.APP_LOG_FILE);
                    if (fileHandle) {
                        await this.fileSystem.appendToFile(fileHandle, logLine);
                    }
                }
                
                console.log(`üìù App Log: ${action}`, details);
            }

            // –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–¥–∞–∂–∏
            async logSale(saleData) {
                const saleEntry = {
                    timestamp: new Date().toISOString(),
                    saleId: 'SALE_' + Date.now(),
                    items: saleData.items,
                    totalAmount: saleData.totalAmount,
                    totalItems: saleData.totalItems
                };
                
                // –î–æ–±–∞–≤–ª—è–µ–º –≤ –ø–∞–º—è—Ç—å
                this.salesLog.push(saleEntry);
                if (this.salesLog.length > this.maxLogSize) {
                    this.salesLog = this.salesLog.slice(-this.maxLogSize);
                }
                
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ localStorage
                this.saveToLocalStorage();
                
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ —Ñ–∞–π–ª –µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–Ω–æ
                if (this.fileSystemEnabled) {
                    // 1. –î–æ–±–∞–≤–ª—è–µ–º –≤ –æ–±—â–∏–π –ª–æ–≥ –ø—Ä–æ–¥–∞–∂
                    const saleLine = JSON.stringify(saleEntry) + '\n';
                    const salesFileHandle = await this.fileSystem.getLogFileHandle(this.SALES_LOG_FILE);
                    if (salesFileHandle) {
                        await this.fileSystem.appendToFile(salesFileHandle, saleLine);
                    }
                    
                    // 2. –°–æ–∑–¥–∞–µ–º –æ—Ç–¥–µ–ª—å–Ω—ã–π —Ñ–∞–π–ª —á–µ–∫–∞
                    const receiptContent = this.formatReceipt(saleEntry);
                    const receiptFileName = `receipt_${saleEntry.saleId}.txt`;
                    await this.fileSystem.createFile(receiptFileName, receiptContent);
                    
                    // 3. –î–æ–±–∞–≤–ª—è–µ–º –≤ —Ñ–∞–π–ª –ø—Ä–æ–¥–∞–∂ –∑–∞ —Å–µ–≥–æ–¥–Ω—è
                    await this.appendToTodaySales(saleEntry);
                } else {
                    // –ï—Å–ª–∏ —Ñ–∞–π–ª–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞, —Å–æ—Ö—Ä–∞–Ω—è–µ–º –≤ localStorage
                    const receipts = JSON.parse(localStorage.getItem('gameZoneReceipts') || '[]');
                    receipts.push({
                        id: saleEntry.saleId,
                        content: this.formatReceipt(saleEntry)
                    });
                    localStorage.setItem('gameZoneReceipts', JSON.stringify(receipts));
                }
                
                console.log(`üí∞ Sale Log: –ü—Ä–æ–¥–∞–∂–∞ ${saleEntry.saleId} –Ω–∞ —Å—É–º–º—É ${saleEntry.totalAmount} —Ä—É–±`);
                
                return saleEntry.saleId;
            }

            // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ —Ñ–∞–π–ª –ø—Ä–æ–¥–∞–∂ –∑–∞ —Å–µ–≥–æ–¥–Ω—è
            async appendToTodaySales(saleEntry) {
                if (!this.fileSystemEnabled) return;
                
                const today = new Date().toISOString().split('T')[0];
                const todayFileName = `sales_${today}.txt`;
                
                const saleLine = `${saleEntry.timestamp} | ${saleEntry.saleId} | ${saleEntry.totalAmount} —Ä—É–± | ${saleEntry.totalItems} —à—Ç\n`;
                
                const fileHandle = await this.fileSystem.getLogFileHandle(todayFileName);
                if (fileHandle) {
                    await this.fileSystem.appendToFile(fileHandle, saleLine);
                }
            }

            // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ–∫–∞
            formatReceipt(saleEntry) {
                const date = new Date(saleEntry.timestamp).toLocaleString('ru-RU');
                
                let receipt = `========================================
GAME ZONE - –ß–ï–ö –ü–†–û–î–ê–ñ–ò
========================================
ID: ${saleEntry.saleId}
–î–∞—Ç–∞: ${date}
========================================\n`;
                
                saleEntry.items.forEach((item, index) => {
                    receipt += `${index + 1}. ${item.name}\n`;
                    receipt += `   –ü–ª–∞—Ç—Ñ–æ—Ä–º–∞: ${item.platform}\n`;
                    receipt += `   –®—Ç—Ä–∏—Ö-–∫–æ–¥: ${item.barcode}\n`;
                    receipt += `   –¶–µ–Ω–∞: ${item.price} —Ä—É–± x ${item.quantity} —à—Ç = ${item.total} —Ä—É–±\n`;
                    receipt += `   ---------------------------------\n`;
                });
                
                receipt += `========================================
–ò–¢–û–ì–û –¢–û–í–ê–†–û–í: ${saleEntry.totalItems} —à—Ç
–û–ë–©–ê–Ø –°–£–ú–ú–ê: ${saleEntry.totalAmount} —Ä—É–±
========================================\n`;
                
                return receipt;
            }

            // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ localStorage (–¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏)
            saveToLocalStorage() {
                try {
                    localStorage.setItem('gameZoneAppLog', JSON.stringify(this.appLog));
                    localStorage.setItem('gameZoneSalesLog', JSON.stringify(this.salesLog));
                } catch (error) {
                    console.error('‚ùå –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤ localStorage:', error);
                }
            }

            // –ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑ localStorage
            loadFromLocalStorage() {
                try {
                    const appLog = localStorage.getItem('gameZoneAppLog');
                    const salesLog = localStorage.getItem('gameZoneSalesLog');
                    
                    if (appLog) {
                        this.appLog = JSON.parse(appLog);
                    }
                    
                    if (salesLog) {
                        this.salesLog = JSON.parse(salesLog);
                    }
                    
                    console.log(`üìä –ó–∞–≥—Ä—É–∂–µ–Ω–æ –∏–∑ localStorage: –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ - ${this.appLog.length}, –ü—Ä–æ–¥–∞–∂–∏ - ${this.salesLog.length}`);
                } catch (error) {
                    console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑ localStorage:', error);
                }
            }

            // –ü–æ–ª—É—á–µ–Ω–∏–µ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –ª–æ–≥–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
            getFormattedAppLog() {
                return this.appLog.map(entry => {
                    const time = new Date(entry.timestamp).toLocaleString('ru-RU');
                    return `[${time}] ${entry.action} ${JSON.stringify(entry.details || {})}`;
                }).join('\n');
            }

            // –ü–æ–ª—É—á–µ–Ω–∏–µ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –ª–æ–≥–∞ –ø—Ä–æ–¥–∞–∂
            getFormattedSalesLog() {
                return this.salesLog.map(sale => {
                    const time = new Date(sale.timestamp).toLocaleString('ru-RU');
                    return `[${time}] ${sale.saleId} - ${sale.totalItems} —à—Ç - ${sale.totalAmount} —Ä—É–±`;
                }).join('\n');
            }

            // –ü–æ–ª—É—á–µ–Ω–∏–µ –ø—Ä–æ–¥–∞–∂ –∑–∞ —Å–µ–≥–æ–¥–Ω—è
            getTodaySales() {
                const today = new Date().toISOString().split('T')[0];
                const todaySales = this.salesLog.filter(sale => 
                    sale.timestamp.startsWith(today)
                );
                
                const totalAmount = todaySales.reduce((sum, sale) => sum + sale.totalAmount, 0);
                const totalItems = todaySales.reduce((sum, sale) => sum + sale.totalItems, 0);
                
                let result = `–ü–†–û–î–ê–ñ–ò –ó–ê –°–ï–ì–û–î–ù–Ø (${today})\n`;
                result += `========================================\n`;
                result += `–í—Å–µ–≥–æ –ø—Ä–æ–¥–∞–∂: ${todaySales.length}\n`;
                result += `–í—Å–µ–≥–æ —Ç–æ–≤–∞—Ä–æ–≤: ${totalItems} —à—Ç\n`;
                result += `–û–±—â–∞—è —Å—É–º–º–∞: ${totalAmount} —Ä—É–±\n`;
                result += `========================================\n\n`;
                
                todaySales.forEach((sale, index) => {
                    const time = new Date(sale.timestamp).toLocaleTimeString('ru-RU');
                    result += `${index + 1}. ${time} - ${sale.saleId}\n`;
                    result += `   –¢–æ–≤–∞—Ä–æ–≤: ${sale.totalItems} —à—Ç\n`;
                    result += `   –°—É–º–º–∞: ${sale.totalAmount} —Ä—É–±\n\n`;
                });
                
                return result;
            }

            // –û—á–∏—Å—Ç–∫–∞ –ª–æ–≥–æ–≤
            async clearLogs(type) {
                try {
                    if (type === 'app') {
                        this.appLog = [];
                        localStorage.removeItem('gameZoneAppLog');
                        
                        if (this.fileSystemEnabled) {
                            const fileHandle = await this.fileSystem.getLogFileHandle(this.APP_LOG_FILE);
                            if (fileHandle) {
                                await this.fileSystem.writeFile(fileHandle, '');
                            }
                        }
                    } else if (type === 'sales') {
                        this.salesLog = [];
                        localStorage.removeItem('gameZoneSalesLog');
                        localStorage.removeItem('gameZoneReceipts');
                        
                        if (this.fileSystemEnabled) {
                            const fileHandle = await this.fileSystem.getLogFileHandle(this.SALES_LOG_FILE);
                            if (fileHandle) {
                                await this.fileSystem.writeFile(fileHandle, '');
                            }
                        }
                    }
                    
                    console.log(`‚úÖ –õ–æ–≥–∏ —Ç–∏–ø–∞ "${type}" –æ—á–∏—â–µ–Ω—ã`);
                    return true;
                } catch (error) {
                    console.error(`‚ùå –û—à–∏–±–∫–∞ –æ—á–∏—Å—Ç–∫–∏ –ª–æ–≥–æ–≤ "${type}":`, error);
                    return false;
                }
            }

            // –≠–∫—Å–ø–æ—Ä—Ç –ª–æ–≥–æ–≤
            exportLogs(type) {
                let content = '';
                let filename = '';
                
                if (type === 'app') {
                    content = this.getFormattedAppLog();
                    filename = `gamezone_app_log_${new Date().toISOString().split('T')[0]}.txt`;
                } else if (type === 'sales') {
                    content = this.getFormattedSalesLog();
                    filename = `gamezone_sales_log_${new Date().toISOString().split('T')[0]}.txt`;
                } else if (type === 'today') {
                    content = this.getTodaySales();
                    filename = `gamezone_today_sales_${new Date().toISOString().split('T')[0]}.txt`;
                }
                
                return this.fileSystem.downloadFile(filename, content);
            }

            // –ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
            getSalesStats() {
                const today = new Date();
                today.setHours(0, 0, 0, 0);
                
                const todaySales = this.salesLog.filter(sale => 
                    new Date(sale.timestamp) >= today
                );
                
                const totalToday = todaySales.reduce((sum, sale) => sum + sale.totalAmount, 0);
                const itemsToday = todaySales.reduce((sum, sale) => sum + sale.totalItems, 0);
                
                return {
                    totalSales: this.salesLog.length,
                    totalRevenue: this.salesLog.reduce((sum, sale) => sum + sale.totalAmount, 0),
                    totalItems: this.salesLog.reduce((sum, sale) => sum + sale.totalItems, 0),
                    todaySales: todaySales.length,
                    todayRevenue: totalToday,
                    todayItems: itemsToday
                };
            }
        }

        // –û—Å–Ω–æ–≤–Ω–æ–π –∫–ª–∞—Å—Å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        class GameScannerApp {
            constructor() {
                this.sheetsUrl = 'https://docs.google.com/spreadsheets/d/1fMWJan1HP7tcKwa_hm86oCm0KPtC_zN50UhU72Q8xeA/export?format=csv&gid=1995791598';
                this.localStorageKey = 'gameZoneData';
                this.localDataKey = 'gameZoneGamesData';
                this.isScanning = false;
                this.gamesData = [];
                this.cameraStream = null;
                this.quaggaInitialized = false;
                this.lastScannedCode = null;
                this.scanCooldown = false;
                this.isDataLoaded = false;
                
                this.scannedGames = [];
                this.appVersion = "4.1";
                
                // –õ–æ–≥–≥–µ—Ä —Å —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º–æ–π
                this.logger = new EnhancedLogger();
                
                this.init();
            }

            async init() {
                // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –ª–æ–≥–≥–µ—Ä —Å —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º–æ–π
                await this.logger.init();
                this.logger.logAppAction('APP_START', { version: this.appVersion });
                
                this.setupEventListeners();
                
                // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ
                this.loadFromLocalStorage();
                this.checkForUpdates().catch(error => {
                    console.log('–§–æ–Ω–æ–≤–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –Ω–µ —É–¥–∞–ª–∞—Å—å, –∏—Å–ø–æ–ª—å–∑—É–µ–º –ª–æ–∫–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ');
                });
                
                // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º PWA
                new PWAInstaller();
                
                console.log(`GAME ZONE Scanner ${this.appVersion} - –≥–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ`);
                this.showSalesStats();
            }

            showSalesStats() {
                const stats = this.logger.getSalesStats();
                console.log('üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø—Ä–æ–¥–∞–∂:', stats);
                
                if (stats.todayRevenue > 0) {
                    setTimeout(() => {
                        this.updateStatus(`üí∞ –°–µ–≥–æ–¥–Ω—è: ${stats.todayRevenue} —Ä—É–± (${stats.todayItems} —à—Ç)`, 'success');
                    }, 3000);
                }
            }

            setupEventListeners() {
                // –û—Å–Ω–æ–≤–Ω—ã–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
                document.getElementById('scanner-container').addEventListener('click', () => this.startScanner());
                document.getElementById('search-btn').addEventListener('click', () => this.performSearch());
                document.getElementById('summary-btn').addEventListener('click', () => this.showSummary());
                document.getElementById('sale-btn').addEventListener('click', () => this.processSale());
                document.getElementById('logs-btn').addEventListener('click', () => this.showLogsModal());
                
                // –ü–æ–∏—Å–∫
                document.getElementById('barcode-input').addEventListener('input', () => {
                    const query = document.getElementById('barcode-input').value.trim();
                    if (query.length >= 2) {
                        this.showSearchResults(query);
                    } else {
                        this.hideSearchResults();
                    }
                });
                
                document.getElementById('barcode-input').addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') this.performSearch();
                });
                
                // –ö–∞–º–µ—Ä–∞
                document.getElementById('close-camera').addEventListener('click', () => this.stopScanner());
                document.getElementById('restart-camera').addEventListener('click', () => this.restartCamera());
                document.getElementById('modal-overlay').addEventListener('click', () => this.stopScanner());
                
                // –õ–æ–≥–∏
                document.getElementById('close-logs-btn').addEventListener('click', () => this.hideLogsModal());
                document.getElementById('export-logs-btn').addEventListener('click', () => this.exportLogs());
                document.getElementById('clear-logs-btn').addEventListener('click', () => this.clearLogs());
                
                // –¢–∞–±—ã –≤ –º–æ–¥–∞–ª–∫–µ –ª–æ–≥–æ–≤
                document.querySelectorAll('.logs-tab').forEach(tab => {
                    tab.addEventListener('click', () => {
                        const tabType = tab.getAttribute('data-tab');
                        this.switchLogsTab(tabType);
                    });
                });
            }

            // –†–ê–ë–û–¢–ê –° –õ–û–ì–ê–ú–ò
            showLogsModal() {
                console.log('üìÅ –û—Ç–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ª–æ–≥–æ–≤');
                document.getElementById('modal-overlay').style.display = 'block';
                document.getElementById('logs-modal').style.display = 'block';
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ª–æ–≥ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
                this.switchLogsTab('app');
            }

            hideLogsModal() {
                document.getElementById('modal-overlay').style.display = 'none';
                document.getElementById('logs-modal').style.display = 'none';
            }

            switchLogsTab(tabType) {
                // –û–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—É—é –≤–∫–ª–∞–¥–∫—É
                document.querySelectorAll('.logs-tab').forEach(tab => {
                    tab.classList.remove('active');
                    if (tab.getAttribute('data-tab') === tabType) {
                        tab.classList.add('active');
                    }
                });
                
                // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π –ª–æ–≥
                let logContent = '';
                
                switch(tabType) {
                    case 'app':
                        logContent = this.logger.getFormattedAppLog();
                        break;
                    case 'sales':
                        logContent = this.logger.getFormattedSalesLog();
                        break;
                    case 'today':
                        logContent = this.logger.getTodaySales();
                        break;
                }
                
                // –ï—Å–ª–∏ –ª–æ–≥ –ø—É—Å—Ç–æ–π
                if (!logContent.trim()) {
                    logContent = '–õ–æ–≥ –ø—É—Å—Ç–æ–π';
                }
                
                document.getElementById('logs-content').textContent = logContent;
            }

            exportLogs() {
                const activeTab = document.querySelector('.logs-tab.active').getAttribute('data-tab');
                const success = this.logger.exportLogs(activeTab);
                
                if (success) {
                    alert(`‚úÖ –õ–æ–≥ "${activeTab}" —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω —É—Å–ø–µ—à–Ω–æ!`);
                } else {
                    alert('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —ç–∫—Å–ø–æ—Ä—Ç–µ –ª–æ–≥–∞');
                }
            }

            async clearLogs() {
                const activeTab = document.querySelector('.logs-tab.active').getAttribute('data-tab');
                
                if (confirm(`–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –æ—á–∏—Å—Ç–∏—Ç—å –ª–æ–≥ "${activeTab}"?`)) {
                    const success = await this.logger.clearLogs(activeTab);
                    
                    if (success) {
                        alert(`‚úÖ –õ–æ–≥ "${activeTab}" –æ—á–∏—â–µ–Ω!`);
                        this.switchLogsTab(activeTab); // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ
                    } else {
                        alert('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—á–∏—Å—Ç–∫–µ –ª–æ–≥–∞');
                    }
                }
            }

            // –û–°–¢–ê–õ–¨–ù–´–ï –ú–ï–¢–û–î–´ (–∞–Ω–∞–ª–æ–≥–∏—á–Ω—ã –ø—Ä–µ–¥—ã–¥—É—â–µ–π –≤–µ—Ä—Å–∏–∏ —Å –Ω–µ–±–æ–ª—å—à–∏–º–∏ –∞–¥–∞–ø—Ç–∞—Ü–∏—è–º–∏)
            updateStatus(message, type = '') {
                const statusEl = document.getElementById('status');
                const statusText = document.getElementById('status-text');
                
                statusText.textContent = message;
                statusEl.className = 'status';
                
                if (type === 'error') {
                    statusEl.classList.add('error');
                } else if (type === 'success') {
                    statusEl.classList.add('success');
                }
            }

            loadFromLocalStorage() {
                try {
                    const savedData = localStorage.getItem(this.localDataKey);
                    const savedScans = localStorage.getItem(this.localStorageKey);
                    
                    if (savedData) {
                        this.gamesData = JSON.parse(savedData);
                        this.isDataLoaded = true;
                        console.log(`‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω–æ ${this.gamesData.length} –∏–≥—Ä –∏–∑ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞`);
                        this.updateStatus(`‚úÖ –ì–æ—Ç–æ–≤! ${this.gamesData.length} –∏–≥—Ä –≤ –±–∞–∑–µ`, 'success');
                        this.logger.logAppAction('DATA_LOADED', { count: this.gamesData.length });
                    } else {
                        this.updateStatus('‚è≥ –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ Google Sheets...');
                    }
                    
                    if (savedScans) {
                        this.scannedGames = JSON.parse(savedScans);
                        this.updateSummaryButton();
                    }
                    
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ª–æ–∫–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö:', error);
                    this.updateStatus('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ª–æ–∫–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö', 'error');
                    this.logger.logAppAction('DATA_LOAD_ERROR', { error: error.message });
                }
            }

            // ... –æ—Å—Ç–∞–ª—å–Ω—ã–µ –º–µ—Ç–æ–¥—ã –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π ...
            // (–≤—Å–µ –º–µ—Ç–æ–¥—ã –∏–∑ –ø—Ä–µ–¥—ã–¥—É—â–µ–π –≤–µ—Ä—Å–∏–∏ –æ—Å—Ç–∞—é—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π, 
            // —Ç–æ–ª—å–∫–æ –≤–µ–∑–¥–µ –∑–∞–º–µ–Ω—è–µ–º this.logger.logAppAction –∏ this.logger.logSale)
        }

        document.addEventListener('DOMContentLoaded', () => {
            new GameScannerApp();
        });
    </script>
</body>
</html>
