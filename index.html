<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GAME ZONE - –°–∫–∞–Ω–µ—Ä –∏–≥—Ä</title>
    <meta name="theme-color" content="#0078D7">
    <link rel="manifest" href="manifest.json">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .container {
            max-width: 400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            position: relative;
            z-index: 1;
        }
        .header { 
            text-align: center; 
            margin-bottom: 20px; 
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        .header h1 { 
            color: #333; 
            font-size: 24px; 
            margin-bottom: 5px;
        }
        .store-icon {
            width: 40px;
            height: 40px;
            border-radius: 8px;
            background: linear-gradient(45deg, #ff6b6b, #ffa726);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 18px;
        }
        .btn {
            width: 100%;
            padding: 15px;
            background: #0078D7;
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            margin: 10px 0;
            cursor: pointer;
        }
        #scanner-container {
            width: 100%;
            height: 200px;
            background: #f0f0f0;
            border-radius: 10px;
            margin: 15px 0;
            position: relative;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 2px dashed #ccc;
        }
        .scanner-placeholder {
            text-align: center;
            color: #666;
        }
        .scanner-placeholder .icon {
            font-size: 48px;
            margin-bottom: 10px;
        }
        input {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 10px;
            margin: 10px 0;
            text-align: center;
            font-size: 16px;
        }
        .game-info {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 20px;
            margin-top: 20px;
            display: none;
        }
        .game-info.visible { display: block; }
        .info-row {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #eee;
        }
        .info-label { color: #666; font-weight: 500; min-width: 140px; }
        .info-value { color: #333; font-weight: 600; text-align: right; flex: 1; }
        .price-final {
            color: #0078D7;
            font-size: 20px;
            font-weight: bold;
            text-align: center;
            margin: 15px 0;
            padding: 15px;
            background: #e3f2fd;
            border-radius: 10px;
            border: 2px solid #0078D7;
        }
        .status {
            text-align: center;
            padding: 10px;
            margin: 10px 0;
            border-radius: 8px;
            background: #fff3cd;
            color: #856404;
        }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è –∫–æ–º–ø–∞–∫—Ç–Ω–æ–≥–æ –æ–∫–Ω–∞ –∫–∞–º–µ—Ä—ã */
        #camera-modal {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 90%;
            max-width: 400px;
            background: white;
            border-radius: 20px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            z-index: 1000;
            display: none;
        }
        .camera-container {
            position: relative;
            width: 100%;
            height: 300px;
            background: black;
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 15px;
        }
        .camera-view {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        .camera-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border: 3px solid #0078D7;
            pointer-events: none;
        }
        .camera-line {
            position: absolute;
            width: 100%;
            height: 3px;
            background: #ff0000;
            animation: scan 2s infinite linear;
        }
        @keyframes scan {
            0%, 100% { top: 10%; }
            50% { top: 90%; }
        }
        .camera-controls {
            display: flex;
            gap: 10px;
        }
        .camera-btn {
            flex: 1;
            padding: 12px;
            background: #0078D7;
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 14px;
            cursor: pointer;
        }
        .camera-btn.secondary {
            background: #6c757d;
        }
        
        /* –ó–∞—Ç–µ–º–Ω–µ–Ω–∏–µ —Ñ–æ–Ω–∞ */
        #modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            z-index: 999;
            display: none;
        }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –∫–∞–º–µ—Ä—ã */
        #camera-permission {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 2000;
            display: none;
            justify-content: center;
            align-items: center;
        }
        .permission-dialog {
            background: white;
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            max-width: 300px;
            margin: 20px;
        }
        
        .scanning-status {
            text-align: center;
            padding: 8px;
            margin: 5px 0;
            border-radius: 5px;
            font-size: 14px;
        }
        .scanning-success {
            background: #d4edda;
            color: #155724;
        }
        .scanning-error {
            background: #f8d7da;
            color: #721c24;
        }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è –∏—Ç–æ–≥–æ–≤–æ–π —Å—É–º–º—ã */
        .summary-section {
            margin-top: 20px;
            display: none;
        }
        .summary-section.visible { display: block; }
        .summary-header {
            text-align: center;
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 15px;
            color: #333;
        }
        .scanned-games-list {
            max-height: 200px;
            overflow-y: auto;
            margin-bottom: 15px;
            border: 1px solid #ddd;
            border-radius: 10px;
            padding: 10px;
        }
        .scanned-game-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 5px;
            border-bottom: 1px solid #eee;
            font-size: 14px;
        }
        .scanned-game-item:last-child {
            border-bottom: none;
        }
        .game-number {
            color: #666;
            min-width: 25px;
        }
        .game-name {
            flex: 1;
            text-align: left;
            padding: 0 10px;
        }
        .game-price {
            color: #0078D7;
            font-weight: bold;
            min-width: 70px;
            text-align: right;
        }
        .total-sum {
            text-align: center;
            font-size: 20px;
            font-weight: bold;
            color: #28a745;
            padding: 15px;
            background: #f8fff9;
            border-radius: 10px;
            border: 2px solid #28a745;
            margin: 10px 0;
        }
        .summary-buttons {
            display: flex;
            gap: 10px;
        }
        .summary-btn {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 10px;
            font-size: 14px;
            cursor: pointer;
        }
        .reset-btn {
            background: #dc3545;
            color: white;
        }
        .summary-main-btn {
            background: #28a745;
            color: white;
        }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ —Å–∫–∞–Ω–µ—Ä–∞ */
        .restart-scanner {
            text-align: center;
            margin-top: 10px;
        }
        .restart-btn {
            padding: 8px 16px;
            background: #28a745;
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 12px;
            cursor: pointer;
        }

        /* –í–µ—Ä—Å–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è */
        .app-version {
            text-align: center;
            margin-top: 20px;
            font-size: 12px;
            color: #666;
            padding: 10px;
            border-top: 1px solid #eee;
        }

        /* –ò–∫–æ–Ω–∫–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã */
        .platform-icon {
            display: inline-block;
            width: 20px;
            height: 20px;
            margin-right: 5px;
            vertical-align: middle;
            background-size: contain;
            background-repeat: no-repeat;
            border-radius: 3px;
            color: white;
            font-size: 10px;
            text-align: center;
            line-height: 20px;
            font-weight: bold;
        }
        .ps4-icon { background-color: #0070d1; }
        .ps5-icon { background-color: #000; }
        .ns-icon { background-color: #e60012; }
        .xbox-icon { background-color: #107c10; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="store-icon">GZ</div>
            <div>
                <h1>GAME ZONE</h1>
                <p>–°–∫–∞–Ω–µ—Ä –∏–≥—Ä–æ–≤—ã—Ö –¥–∏—Å–∫–æ–≤</p>
            </div>
        </div>

        <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –∫–∞–º–µ—Ä—ã -->
        <div id="scanner-container">
            <div class="scanner-placeholder">
                <div class="icon">üì∑</div>
                <div>–ù–∞–∂–º–∏—Ç–µ "–ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–∫–∞–Ω–µ—Ä"</div>
            </div>
        </div>

        <button id="start-btn" class="btn">üì∑ –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–∫–∞–Ω–µ—Ä</button>

        <input type="text" id="barcode-input" placeholder="–ò–ª–∏ –≤–≤–µ–¥–∏—Ç–µ —à—Ç—Ä–∏—Ö-–∫–æ–¥ –≤—Ä—É—á–Ω—É—é">
        <button id="search-btn" class="btn">üîç –ù–∞–π—Ç–∏ –∏–≥—Ä—É</button>

        <!-- –ö–Ω–æ–ø–∫–∞ –ò–¢–û–ì–û -->
        <button id="summary-btn" class="btn" style="background: #28a745;">üí∞ –ò–¢–û–ì–û</button>

        <!-- –°—Ç–∞—Ç—É—Å —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è -->
        <div id="scanning-status" class="scanning-status" style="display: none;"></div>

        <div id="status" class="status">
            –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ...
        </div>

        <div id="game-info" class="game-info">
            <!-- –¶–µ–Ω–∞ –ø—Ä–æ–¥–∞–∂–∏ - –ü–ï–†–í–ê–Ø –∏ –≤—ã–¥–µ–ª–µ–Ω–Ω–∞—è -->
            <div class="price-final">
                üí∞ –¶–µ–Ω–∞ –ø—Ä–æ–¥–∞–∂–∏: <span id="game-final-price"></span> —Ä—É–±
            </div>
            
            <!-- –ù–∞–∑–≤–∞–Ω–∏–µ –∏–≥—Ä—ã - –í–¢–û–†–ê–Ø -->
            <div class="info-row">
                <span class="info-label">–ù–∞–∑–≤–∞–Ω–∏–µ –∏–≥—Ä—ã:</span>
                <span class="info-value" id="game-name"></span>
            </div>
            
            <!-- –Ø–∑—ã–∫ –∏–≥—Ä—ã - –¢–†–ï–¢–ò–ô -->
            <div class="info-row">
                <span class="info-label">–Ø–∑—ã–∫ –∏–≥—Ä—ã:</span>
                <span class="info-value" id="game-language"></span>
            </div>
            
            <!-- –û—Å—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
            <div class="info-row">
                <span class="info-label">–ü–ª–∞—Ç—Ñ–æ—Ä–º–∞:</span>
                <span class="info-value" id="game-platform"></span>
            </div>
            <div class="info-row" id="game-code-row">
                <span class="info-label" id="game-code-label">CUSA:</span>
                <span class="info-value" id="game-code"></span>
            </div>
            <div class="info-row">
                <span class="info-label">–®—Ç—Ä–∏—Ö-–∫–æ–¥:</span>
                <span class="info-value" id="game-barcode"></span>
            </div>
            <div class="info-row">
                <span class="info-label">–¶–µ–Ω–∞ –≤ –ú–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å–µ:</span>
                <span class="info-value" id="game-marketplace"></span>
            </div>
        </div>

        <!-- –°–µ–∫—Ü–∏—è –∏—Ç–æ–≥–æ–≤–æ–π —Å—É–º–º—ã -->
        <div id="summary-section" class="summary-section">
            <div class="summary-header">üìä –û—Ç—Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∏–≥—Ä—ã</div>
            
            <div id="scanned-games-list" class="scanned-games-list">
                <!-- –°–ø–∏—Å–æ–∫ –∏–≥—Ä –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª—è—Ç—å—Å—è –∑–¥–µ—Å—å -->
            </div>
            
            <div class="total-sum">
                –û–±—â–∞—è —Å—É–º–º–∞: <span id="total-amount">0</span> —Ä—É–±
            </div>
            
            <div class="summary-buttons">
                <button id="reset-scans-btn" class="summary-btn reset-btn">üîÑ –°–±—Ä–æ—Å–∏—Ç—å –≤—Å–µ</button>
                <button id="close-summary-btn" class="summary-btn summary-main-btn">‚úñ –ó–∞–∫—Ä—ã—Ç—å</button>
            </div>
        </div>
        
        <!-- –ö–Ω–æ–ø–∫–∞ –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–≥–æ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ —Å–∫–∞–Ω–µ—Ä–∞ -->
        <div class="restart-scanner">
            <button id="restart-scanner-btn" class="restart-btn" style="display: none;">üîÑ –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å —Å–∫–∞–Ω–µ—Ä</button>
        </div>

        <!-- –í–µ—Ä—Å–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è -->
        <div class="app-version">
            –í–µ—Ä—Å–∏—è 2.1 | GAME ZONE Scanner
        </div>
    </div>

    <!-- –ö–æ–º–ø–∞–∫—Ç–Ω–æ–µ –æ–∫–Ω–æ –∫–∞–º–µ—Ä—ã -->
    <div id="modal-overlay"></div>
    <div id="camera-modal">
        <div class="camera-container">
            <video id="camera-view" class="camera-view" autoplay playsinline></video>
            <div class="camera-overlay">
                <div class="camera-line"></div>
            </div>
        </div>
        <div class="camera-controls">
            <button id="close-camera" class="camera-btn secondary">‚ùå –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ</button>
        </div>
        <div id="camera-status" class="scanning-status" style="margin-top: 10px;"></div>
        <div class="restart-scanner">
            <button id="restart-camera-btn" class="restart-btn">üîÑ –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –∫–∞–º–µ—Ä—É</button>
        </div>
    </div>

    <!-- –î–∏–∞–ª–æ–≥ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –∫–∞–º–µ—Ä—ã -->
    <div id="camera-permission">
        <div class="permission-dialog">
            <h3>üì∑ –†–∞–∑—Ä–µ—à–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ –∫–∞–º–µ—Ä–µ?</h3>
            <p>–ü—Ä–∏–ª–æ–∂–µ–Ω–∏—é –Ω—É–∂–µ–Ω –¥–æ—Å—Ç—É–ø –∫ –∫–∞–º–µ—Ä–µ –¥–ª—è —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è —à—Ç—Ä–∏—Ö-–∫–æ–¥–æ–≤</p>
            <button id="allow-camera" class="btn" style="margin: 10px 0;">–†–∞–∑—Ä–µ—à–∏—Ç—å</button>
            <button id="deny-camera" class="btn" style="background: #6c757d;">–û—Ç–º–µ–Ω–∞</button>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@ericblade/quagga2@1.8.1/dist/quagga.min.js"></script>
    
    <script>
        class GameScannerApp {
            constructor() {
                this.sheetsUrl = 'https://docs.google.com/spreadsheets/d/1fMWJan1HP7tcKwa_hm86oCm0KPtC_zN50UhU72Q8xeA/export?format=csv&gid=1995791598';
                this.isScanning = false;
                this.gamesData = [];
                this.cameraStream = null;
                this.cameraPermissionGranted = false;
                this.dataUpdateInterval = null;
                this.scanningTimeout = null;
                this.quaggaInitialized = false;
                this.lastScannedCode = null;
                this.scanCooldown = false;
                
                // –ú–∞—Å—Å–∏–≤ –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –æ—Ç—Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∏–≥—Ä
                this.scannedGames = [];
                
                // –í–µ—Ä—Å–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
                this.appVersion = "2.1";
                
                this.init();
            }

            async init() {
                this.setupEventListeners();
                await this.loadGamesData();
                this.startDataAutoUpdate();
                this.displayAppVersion();
            }

            displayAppVersion() {
                console.log(`GAME ZONE Scanner v${this.appVersion}`);
            }

            setupEventListeners() {
                document.getElementById('start-btn').addEventListener('click', () => this.startScanner());
                document.getElementById('search-btn').addEventListener('click', () => {
                    const barcode = document.getElementById('barcode-input').value.trim();
                    if (barcode) this.findGameByBarcode(barcode);
                });
                document.getElementById('barcode-input').addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        const barcode = e.target.value.trim();
                        if (barcode) this.findGameByBarcode(barcode);
                    }
                });
                
                // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫ –∏—Ç–æ–≥–æ–≤–æ–π —Å—É–º–º—ã
                document.getElementById('summary-btn').addEventListener('click', () => this.showSummary());
                document.getElementById('reset-scans-btn').addEventListener('click', () => this.resetScannedGames());
                document.getElementById('close-summary-btn').addEventListener('click', () => this.hideSummary());
                
                document.getElementById('close-camera').addEventListener('click', () => this.stopScanner());
                document.getElementById('restart-scanner-btn').addEventListener('click', () => this.restartScanner());
                document.getElementById('restart-camera-btn').addEventListener('click', () => this.restartCamera());
                
                // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –¥–∏–∞–ª–æ–≥–∞ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –∫–∞–º–µ—Ä—ã
                document.getElementById('allow-camera').addEventListener('click', () => this.requestCameraAccess());
                document.getElementById('deny-camera').addEventListener('click', () => {
                    document.getElementById('camera-permission').style.display = 'none';
                });

                document.getElementById('modal-overlay').addEventListener('click', () => this.stopScanner());
            }

            async loadGamesData() {
                document.getElementById('status').textContent = 'üîÑ –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ...';
                
                try {
                    const response = await fetch(this.sheetsUrl + '&t=' + Date.now());
                    
                    if (!response.ok) {
                        throw new Error('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏: ' + response.status);
                    }
                    
                    const csvText = await response.text();
                    this.gamesData = this.parseCSVOptimized(csvText);
                    
                    document.getElementById('status').textContent = `‚úÖ –î–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã! –ù–∞–π–¥–µ–Ω–æ ${this.gamesData.length} –∏–≥—Ä`;
                    
                    setTimeout(() => {
                        if (document.getElementById('status').textContent.includes('–ù–∞–π–¥–µ–Ω–æ')) {
                            document.getElementById('status').textContent = '–ì–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ!';
                        }
                    }, 3000);
                    
                } catch (error) {
                    document.getElementById('status').textContent = '‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö';
                    console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏:', error);
                    setTimeout(() => this.loadGamesData(), 10000);
                }
            }

            // –û–ü–¢–ò–ú–ò–ó–ò–†–û–í–ê–ù–ù–´–ô –ü–ê–†–°–ò–ù–ì CSV
            parseCSVOptimized(csvText) {
                const games = [];
                const rows = csvText.split('\n');
                
                console.time('CSV Parsing');
                
                for (let i = 1; i < rows.length; i++) {
                    const row = rows[i].trim();
                    if (!row) continue;
                    
                    // –ë—ã—Å—Ç—Ä—ã–π –ø–∞—Ä—Å–∏–Ω–≥ —Å—Ç—Ä–æ–∫–∏ CSV
                    const cells = [];
                    let currentCell = '';
                    let inQuotes = false;
                    
                    for (let j = 0; j < row.length; j++) {
                        const char = row[j];
                        if (char === '"') {
                            inQuotes = !inQuotes;
                        } else if (char === ',' && !inQuotes) {
                            cells.push(currentCell.trim());
                            currentCell = '';
                        } else {
                            currentCell += char;
                        }
                    }
                    cells.push(currentCell.trim());
                    
                    // PS4 –∏–≥—Ä—ã (—Å—Ç–æ–ª–±—Ü—ã A-H: 0-7)
                    if (cells[0] && cells[0].toUpperCase().includes('PS4') && cells[1] && cells[2]) {
                        games.push({
                            platform: cells[0],
                            barcode: cells[1],
                            name: cells[2],
                            code: cells[3] || '', // CUSA
                            language: cells[4] || '',
                            optPrice: cells[5] || '',
                            marketplace: cells[6] || '',
                            codeType: 'CUSA'
                        });
                    }
                    
                    // PS5 –∏–≥—Ä—ã (—Å—Ç–æ–ª–±—Ü—ã J-O: 9-14)
                    if (cells[9] && cells[9].toUpperCase().includes('PS5') && cells[10] && cells[11]) {
                        games.push({
                            platform: cells[9],
                            barcode: cells[10],
                            name: cells[11],
                            code: cells[12] || '', // PPSA
                            language: cells[13] || '',
                            optPrice: cells[14] || '',
                            marketplace: '',
                            codeType: 'PPSA'
                        });
                    }
                    
                    // Nintendo Switch –∏–≥—Ä—ã (—Å—Ç–æ–ª–±—Ü—ã R-V: 17-21)
                    if (cells[17] && cells[17].toUpperCase().includes('NS') && cells[18] && cells[19]) {
                        games.push({
                            platform: cells[17],
                            barcode: cells[18],
                            name: cells[19],
                            code: '', // –î–ª—è NS –Ω–µ—Ç –∫–æ–¥–∞
                            language: cells[20] || '',
                            optPrice: cells[21] || '',
                            marketplace: '',
                            codeType: ''
                        });
                    }
                    
                    // Xbox One –∏–≥—Ä—ã (—Å—Ç–æ–ª–±—Ü—ã Y-AC: 24-28)
                    if (cells[24] && cells[24].toUpperCase().includes('XBOX') && cells[25] && cells[26]) {
                        games.push({
                            platform: cells[24],
                            barcode: cells[25],
                            name: cells[26],
                            code: '', // –î–ª—è Xbox –Ω–µ—Ç –∫–æ–¥–∞
                            language: cells[27] || '',
                            optPrice: cells[28] || '',
                            marketplace: '',
                            codeType: ''
                        });
                    }
                }
                
                console.timeEnd('CSV Parsing');
                
                const ps4Count = games.filter(g => g.platform.includes('PS4')).length;
                const ps5Count = games.filter(g => g.platform.includes('PS5')).length;
                const nsCount = games.filter(g => g.platform.includes('NS')).length;
                const xboxCount = games.filter(g => g.platform.includes('XBOX')).length;
                
                console.log(`–ó–∞–≥—Ä—É–∂–µ–Ω–æ –∏–≥—Ä: ${games.length} (PS4: ${ps4Count}, PS5: ${ps5Count}, NS: ${nsCount}, Xbox: ${xboxCount})`);
                
                return games;
            }

            startDataAutoUpdate() {
                this.dataUpdateInterval = setInterval(() => {
                    this.loadGamesData();
                }, 5 * 60 * 1000);
            }

            async startScanner() {
                if (this.gamesData.length === 0) {
                    alert('–î–∞–Ω–Ω—ã–µ –µ—â–µ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è. –ü–æ–¥–æ–∂–¥–∏—Ç–µ –Ω–µ–º–Ω–æ–≥–æ.');
                    return;
                }
                
                console.log('üöÄ –ó–∞–ø—É—Å–∫ —Å–∫–∞–Ω–µ—Ä–∞ v' + this.appVersion);
                
                // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ
                this.resetScannerState();
                
                if (this.cameraPermissionGranted) {
                    this.showCameraModal();
                    return;
                }
                
                try {
                    const permissionStatus = await navigator.permissions.query({ name: 'camera' });
                    
                    if (permissionStatus.state === 'granted') {
                        this.cameraPermissionGranted = true;
                        this.showCameraModal();
                    } else if (permissionStatus.state === 'prompt') {
                        document.getElementById('camera-permission').style.display = 'flex';
                    } else {
                        alert('–î–æ—Å—Ç—É–ø –∫ –∫–∞–º–µ—Ä–µ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω. –†–∞–∑—Ä–µ—à–∏—Ç–µ –¥–æ—Å—Ç—É–ø –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö –±—Ä–∞—É–∑–µ—Ä–∞.');
                    }
                } catch (error) {
                    document.getElementById('camera-permission').style.display = 'flex';
                }
            }

            resetScannerState() {
                this.isScanning = false;
                this.quaggaInitialized = false;
                this.lastScannedCode = null;
                this.scanCooldown = false;
                
                // –û—á–∏—â–∞–µ–º –≤—Å–µ —Ç–∞–π–º–∞—É—Ç—ã
                if (this.scanningTimeout) {
                    clearTimeout(this.scanningTimeout);
                    this.scanningTimeout = null;
                }
                
                console.log('üîÑ –°–æ—Å—Ç–æ—è–Ω–∏–µ —Å–∫–∞–Ω–µ—Ä–∞ —Å–±—Ä–æ—à–µ–Ω–æ');
            }

            showCameraModal() {
                document.getElementById('modal-overlay').style.display = 'block';
                document.getElementById('camera-modal').style.display = 'block';
                this.initializeCamera();
            }

            hideCameraModal() {
                document.getElementById('modal-overlay').style.display = 'none';
                document.getElementById('camera-modal').style.display = 'none';
            }

            updateCameraStatus(message, type = '') {
                const statusEl = document.getElementById('camera-status');
                statusEl.textContent = message;
                statusEl.className = `scanning-status ${type}`;
                statusEl.style.display = 'block';
            }

            async requestCameraAccess() {
                document.getElementById('camera-permission').style.display = 'none';
                
                try {
                    await this.initializeCamera();
                    this.cameraPermissionGranted = true;
                    this.showCameraModal();
                } catch (error) {
                    alert('–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ –∫–∞–º–µ—Ä–µ: ' + error.message);
                }
            }

            async initializeCamera() {
                try {
                    // –ü–æ–ª–Ω–æ—Å—Ç—å—é –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–π –ø–æ—Ç–æ–∫
                    if (this.cameraStream) {
                        this.cameraStream.getTracks().forEach(track => track.stop());
                        this.cameraStream = null;
                    }
                    
                    this.cameraStream = await navigator.mediaDevices.getUserMedia({ 
                        video: { 
                            facingMode: "environment",
                            width: { ideal: 1280 },
                            height: { ideal: 720 }
                        } 
                    });
                    
                    const cameraView = document.getElementById('camera-view');
                    cameraView.srcObject = this.cameraStream;
                    
                    this.updateCameraStatus('üîç –°–∫–∞–Ω–∏—Ä—É—é...');
                    this.startQuaggaScanner();
                    
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ –∫–∞–º–µ—Ä–µ:', error);
                    this.hideCameraModal();
                    
                    if (error.name === 'NotAllowedError') {
                        alert('–î–æ—Å—Ç—É–ø –∫ –∫–∞–º–µ—Ä–µ –∑–∞–ø—Ä–µ—â–µ–Ω. –†–∞–∑—Ä–µ—à–∏—Ç–µ –¥–æ—Å—Ç—É–ø –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö –±—Ä–∞—É–∑–µ—Ä–∞.');
                    } else {
                        alert('–û—à–∏–±–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ –∫–∞–º–µ—Ä–µ: ' + error.message);
                    }
                }
            }

            startQuaggaScanner() {
                this.isScanning = true;
                
                // –û—á–∏—â–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–π —Ç–∞–π–º–∞—É—Ç
                if (this.scanningTimeout) {
                    clearTimeout(this.scanningTimeout);
                    this.scanningTimeout = null;
                }
                
                console.log('üéØ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Quagga —Å–∫–∞–Ω–µ—Ä–∞');
                
                // –ü–æ–ª–Ω–æ—Å—Ç—å—é –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º Quagga –µ—Å–ª–∏ –±—ã–ª –∑–∞–ø—É—â–µ–Ω
                try {
                    Quagga.stop();
                } catch (e) {}
                
                Quagga.init({
                    inputStream: {
                        name: "Live",
                        type: "LiveStream",
                        target: document.getElementById('camera-view'),
                        constraints: {
                            width: 1280,
                            height: 720,
                            facingMode: "environment"
                        }
                    },
                    decoder: {
                        readers: [
                            "ean_reader", 
                            "ean_8_reader", 
                            "code_128_reader",
                            "upc_reader",
                            "upc_e_reader"
                        ]
                    },
                    locator: {
                        patchSize: "medium",
                        halfSample: true
                    },
                    locate: true,
                    numOfWorkers: 2,
                    frequency: 10,
                    multiple: false
                }, (err) => {
                    if (err) {
                        console.error('‚ùå –û—à–∏–±–∫–∞ Quagga:', err);
                        this.updateCameraStatus('‚ùå –û—à–∏–±–∫–∞ —Å–∫–∞–Ω–µ—Ä–∞', 'scanning-error');
                        document.getElementById('restart-scanner-btn').style.display = 'block';
                        return;
                    }
                    
                    console.log('‚úÖ Quagga —Å–∫–∞–Ω–µ—Ä —É—Å–ø–µ—à–Ω–æ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω');
                    Quagga.start();
                    this.quaggaInitialized = true;
                    
                    // –£–±–∏—Ä–∞–µ–º —Å—Ç–∞—Ä—ã–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∏ –¥–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—ã–π
                    Quagga.offDetected();
                    Quagga.onDetected((result) => {
                        if (this.isScanning && !this.scanCooldown) {
                            this.handleBarcodeDetection(result);
                        }
                    });
                });
            }

            handleBarcodeDetection(result) {
                if (!result.codeResult.code) {
                    return;
                }
                
                const code = result.codeResult.code.toString().trim();
                console.log('üì∑ –°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω —à—Ç—Ä–∏—Ö-–∫–æ–¥:', code);
                
                // –ó–∞—â–∏—Ç–∞ –æ—Ç –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è —Ç–æ–≥–æ –∂–µ –∫–æ–¥–∞
                if (this.lastScannedCode === code) {
                    console.log('üîÑ –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –ø–æ–≤—Ç–æ—Ä–Ω–æ–µ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ:', code);
                    return;
                }
                
                // –ë–ª–æ–∫–∏—Ä—É–µ–º –¥–∞–ª—å–Ω–µ–π—à–µ–µ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ –≤—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏
                this.scanCooldown = true;
                this.lastScannedCode = code;
                
                // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º Quagga –Ω–∞ –≤—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏
                try {
                    Quagga.stop();
                } catch (e) {}
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å
                this.updateCameraStatus(`üì∑ –ù–∞–π–¥–µ–Ω –∫–æ–¥: ${code}`, 'scanning-success');
                
                // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –∫–æ–¥
                this.processScannedBarcode(code);
            }

            async processScannedBarcode(barcode) {
                const normalizedBarcode = barcode.toString().trim();
                console.log('üîç –ò—â–µ–º –≤ –±–∞–∑–µ –∫–æ–¥:', normalizedBarcode);
                
                // –ë–´–°–¢–†–´–ô –ü–û–ò–°–ö –í –ë–ê–ó–ï
                const game = this.gamesData.find(g => {
                    if (!g.barcode) return false;
                    const barcodes = g.barcode.split('/').map(b => b.trim());
                    return barcodes.some(bc => bc === normalizedBarcode);
                });
                
                if (game) {
                    // –ò–≥—Ä–∞ –Ω–∞–π–¥–µ–Ω–∞
                    console.log('‚úÖ –ò–≥—Ä–∞ –Ω–∞–π–¥–µ–Ω–∞:', game.name, '–ü–ª–∞—Ç—Ñ–æ—Ä–º–∞:', game.platform);
                    this.displayGameInfo(game);
                    this.addToScannedGames(game);
                    document.getElementById('status').textContent = '‚úÖ –ò–≥—Ä–∞ –Ω–∞–π–¥–µ–Ω–∞!';
                    this.updateCameraStatus('‚úÖ –ò–≥—Ä–∞ –Ω–∞–π–¥–µ–Ω–∞! –ó–∞–∫—Ä—ã–≤–∞—é –∫–∞–º–µ—Ä—É...', 'scanning-success');
                    
                    if (navigator.vibrate) navigator.vibrate(100);
                    
                    // –ó–∞–∫—Ä—ã–≤–∞–µ–º –∫–∞–º–µ—Ä—É —á–µ—Ä–µ–∑ 1 —Å–µ–∫—É–Ω–¥—É
                    setTimeout(() => {
                        this.stopScanner();
                    }, 1000);
                    
                } else {
                    // –ò–≥—Ä–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ - –í–´–ó–´–í–ê–ï–ú –¢–û –ñ–ï –°–ê–ú–û–ï, –ß–¢–û –ò –ü–†–ò –ù–ê–ñ–ê–¢–ò–ò –ö–ù–û–ü–ö–ò "–ü–ï–†–ï–ó–ê–ü–£–°–¢–ò–¢–¨ –ö–ê–ú–ï–†–£"
                    console.log('‚ùå –ò–≥—Ä–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ –¥–ª—è –∫–æ–¥–∞:', normalizedBarcode);
                    this.updateCameraStatus('‚ùå –ò–≥—Ä–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞. –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞—é –∫–∞–º–µ—Ä—É...', 'scanning-error');
                    document.getElementById('status').textContent = '‚ùå –ò–≥—Ä–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞';
                    
                    if (navigator.vibrate) navigator.vibrate([100, 50, 100]);
                    
                    // –í–ê–ñ–ù–û: –í—ã–∑—ã–≤–∞–µ–º —Ç–æ—Ç –∂–µ –º–µ—Ç–æ–¥, —á—Ç–æ –∏ –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –∫–Ω–æ–ø–∫–∏ "–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –∫–∞–º–µ—Ä—É"
                    setTimeout(() => {
                        if (this.isScanning) {
                            console.log('üîÑ –ê–í–¢–û–ú–ê–¢–ò–ß–ï–°–ö–ò–ô –ü–ï–†–ï–ó–ê–ü–£–°–ö –ö–ê–ú–ï–†–´ –ü–û–°–õ–ï –û–®–ò–ë–ö–ò');
                            this.restartCamera(); // –¢–û–ß–ù–û –¢–ê–ö–û–ô –ñ–ï –ú–ï–¢–û–î –ö–ê–ö –ü–†–ò –ù–ê–ñ–ê–¢–ò–ò –ö–ù–û–ü–ö–ò
                        }
                    }, 1500);
                }
            }

            stopScanner() {
                console.log('üõë –û—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–∫–∞–Ω–µ—Ä–∞');
                this.isScanning = false;
                this.scanCooldown = false;
                this.lastScannedCode = null;
                
                // –û—á–∏—â–∞–µ–º —Ç–∞–π–º–∞—É—Ç
                if (this.scanningTimeout) {
                    clearTimeout(this.scanningTimeout);
                    this.scanningTimeout = null;
                }
                
                // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º Quagga
                try {
                    Quagga.stop();
                } catch (e) {
                    console.log('Quagga —É–∂–µ –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω');
                }
                
                // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∫–∞–º–µ—Ä—É
                if (this.cameraStream) {
                    this.cameraStream.getTracks().forEach(track => track.stop());
                    this.cameraStream = null;
                }
                
                this.hideCameraModal();
                document.getElementById('camera-status').style.display = 'none';
                document.getElementById('restart-scanner-btn').style.display = 'none';
            }

            restartScanner() {
                console.log('üîÅ –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–π –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Å–∫–∞–Ω–µ—Ä–∞');
                this.stopScanner();
                setTimeout(() => {
                    this.startScanner();
                }, 500);
            }

            // –ú–ï–¢–û–î, –ö–û–¢–û–†–´–ô –í–´–ó–´–í–ê–ï–¢–°–Ø –ò –ü–†–ò –ù–ê–ñ–ê–¢–ò–ò –ö–ù–û–ü–ö–ò, –ò –ü–†–ò –û–®–ò–ë–ö–ï –°–ö–ê–ù–ò–†–û–í–ê–ù–ò–Ø
            restartCamera() {
                console.log('üîÅ –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –∫–∞–º–µ—Ä—ã (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∏–ª–∏ —Ä—É—á–Ω–æ–π)');
                this.updateCameraStatus('üîÑ –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞—é –∫–∞–º–µ—Ä—É...');
                
                // –ü–æ–ª–Ω–æ—Å—Ç—å—é –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ–º –∫–∞–º–µ—Ä—É - –¢–û–ß–ù–û –¢–ê–ö–û–ô –ñ–ï –ö–û–î
                this.stopScanner();
                setTimeout(() => {
                    this.showCameraModal();
                }, 500);
            }

            findGameByBarcode(barcode) {
                if (this.gamesData.length === 0) {
                    alert('–î–∞–Ω–Ω—ã–µ –µ—â–µ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è. –ü–æ–¥–æ–∂–¥–∏—Ç–µ –Ω–µ–º–Ω–æ–≥–æ.');
                    return;
                }
                
                document.getElementById('status').textContent = 'üîç –ò—â–µ–º –∏–≥—Ä—É...';
                
                const normalizedBarcode = barcode.toString().trim();
                console.log('–ò—â–µ–º —à—Ç—Ä–∏—Ö-–∫–æ–¥:', normalizedBarcode);
                
                const game = this.gamesData.find(g => {
                    if (!g.barcode) return false;
                    const barcodes = g.barcode.split('/').map(b => b.trim());
                    return barcodes.some(bc => bc === normalizedBarcode);
                });
                
                if (game) {
                    this.displayGameInfo(game);
                    this.addToScannedGames(game);
                    document.getElementById('status').textContent = '‚úÖ –ò–≥—Ä–∞ –Ω–∞–π–¥–µ–Ω–∞!';
                    if (navigator.vibrate) navigator.vibrate(100);
                } else {
                    this.hideGameInfo();
                    document.getElementById('status').textContent = '‚ùå –ò–≥—Ä–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞';
                    if (navigator.vibrate) navigator.vibrate([100, 50, 100]);
                }
            }

            displayGameInfo(game) {
                const finalPrice = this.calculateFinalPrice(game.optPrice);
                const languageText = this.getLanguageText(game.language);
                
                document.getElementById('game-final-price').textContent = finalPrice > 0 ? finalPrice : '‚Äî';
                document.getElementById('game-name').textContent = game.name;
                document.getElementById('game-language').textContent = languageText || '‚Äî';
                
                // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –ø–ª–∞—Ç—Ñ–æ—Ä–º—É —Å –∏–∫–æ–Ω–∫–æ–π
                const platformElement = document.getElementById('game-platform');
                platformElement.innerHTML = this.getPlatformIcon(game.platform) + game.platform;
                
                document.getElementById('game-barcode').textContent = game.barcode;
                
                // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∫–æ–¥–∞ (CUSA/PPSA) –∏–ª–∏ —Å–∫—Ä—ã–≤–∞–µ–º –µ—Å–ª–∏ –Ω–µ—Ç
                const codeRow = document.getElementById('game-code-row');
                const codeLabel = document.getElementById('game-code-label');
                const codeValue = document.getElementById('game-code');
                
                if (game.code && game.codeType) {
                    codeLabel.textContent = game.codeType + ':';
                    codeValue.textContent = game.code || '‚Äî';
                    codeRow.style.display = 'flex';
                } else {
                    codeRow.style.display = 'none';
                }
                
                // –ú–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å (—Ç–æ–ª—å–∫–æ –¥–ª—è PS4)
                document.getElementById('game-marketplace').textContent = game.marketplace || '‚Äî';
                
                document.getElementById('game-info').classList.add('visible');
            }

            // –ü–æ–ª—É—á–∞–µ–º –∏–∫–æ–Ω–∫—É –¥–ª—è –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã
            getPlatformIcon(platform) {
                if (platform.includes('PS4')) return '<span class="platform-icon ps4-icon" title="PlayStation 4">PS4</span>';
                if (platform.includes('PS5')) return '<span class="platform-icon ps5-icon" title="PlayStation 5">PS5</span>';
                if (platform.includes('NS')) return '<span class="platform-icon ns-icon" title="Nintendo Switch">NS</span>';
                if (platform.includes('XBOX')) return '<span class="platform-icon xbox-icon" title="Xbox One">XB</span>';
                return '';
            }

            hideGameInfo() {
                document.getElementById('game-info').classList.remove('visible');
            }

            addToScannedGames(game) {
                const finalPrice = this.calculateFinalPrice(game.optPrice);
                
                const existingIndex = this.scannedGames.findIndex(g => g.barcode === game.barcode);
                
                if (existingIndex === -1) {
                    this.scannedGames.push({
                        name: game.name,
                        barcode: game.barcode,
                        price: finalPrice,
                        platform: game.platform,
                        platformIcon: this.getPlatformIcon(game.platform)
                    });
                } else {
                    console.log('–ò–≥—Ä–∞ —É–∂–µ –≤ —Å–ø–∏—Å–∫–µ:', game.name);
                }
                
                this.updateSummaryButton();
            }

            updateSummaryButton() {
                const summaryBtn = document.getElementById('summary-btn');
                if (this.scannedGames.length > 0) {
                    const total = this.scannedGames.reduce((sum, game) => sum + game.price, 0);
                    summaryBtn.textContent = `üí∞ –ò–¢–û–ì–û (${this.scannedGames.length} –∏–≥—Ä - ${total} —Ä—É–±)`;
                } else {
                    summaryBtn.textContent = 'üí∞ –ò–¢–û–ì–û';
                }
            }

            showSummary() {
                if (this.scannedGames.length === 0) {
                    alert('–ù–µ—Ç –æ—Ç—Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∏–≥—Ä');
                    return;
                }
                
                const listContainer = document.getElementById('scanned-games-list');
                listContainer.innerHTML = '';
                
                let totalAmount = 0;
                
                this.scannedGames.forEach((game, index) => {
                    const gameElement = document.createElement('div');
                    gameElement.className = 'scanned-game-item';
                    gameElement.innerHTML = `
                        <span class="game-number">${index + 1}.</span>
                        <span class="game-name">${game.platformIcon} ${game.name}</span>
                        <span class="game-price">${game.price} —Ä—É–±</span>
                    `;
                    listContainer.appendChild(gameElement);
                    
                    totalAmount += game.price;
                });
                
                document.getElementById('total-amount').textContent = totalAmount;
                document.getElementById('summary-section').classList.add('visible');
            }

            hideSummary() {
                document.getElementById('summary-section').classList.remove('visible');
            }

            resetScannedGames() {
                this.scannedGames = [];
                this.updateSummaryButton();
                this.hideSummary();
                document.getElementById('status').textContent = '–°–ø–∏—Å–æ–∫ –æ—Ç—Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∏–≥—Ä –æ—á–∏—â–µ–Ω';
            }

            calculateFinalPrice(optPrice) {
                if (!optPrice) return 0;
                try {
                    const cleanPrice = optPrice.replace(',', '.').replace(/\s/g, '');
                    const price = parseFloat(cleanPrice);
                    return isNaN(price) ? 0 : Math.round(price + 1000);
                } catch {
                    return 0;
                }
            }

            getLanguageText(languageCode) {
                const languageMap = {
                    'ENG': '–ê–Ω–≥–ª–∏–π—Å–∫–∏–π —è–∑—ã–∫',
                    'SUB': '–†—É—Å—Å–∫–∏–µ —Å—É–±—Ç–∏—Ç—Ä—ã –∏ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å', 
                    'RUS': '–ü–æ–ª–Ω–æ—Å—Ç—å—é –Ω–∞ —Ä—É—Å—Å–∫–æ–º',
                    'MULTI': '–ú—É–ª—å—Ç–∏ —è–∑—ã–∫',
                    'DE': '–ù–µ–º–µ—Ü–∫–∏–π —è–∑—ã–∫',
                    'FR': '–§—Ä–∞–Ω—Ü—É–∑—Å–∫–∏–π —è–∑—ã–∫',
                    'ES': '–ò—Å–ø–∞–Ω—Å–∫–∏–π —è–∑—ã–∫',
                    'IT': '–ò—Ç–∞–ª—å—è–Ω—Å–∫–∏–π —è–∑—ã–∫'
                };
                return languageMap[languageCode?.toUpperCase()] || languageCode || '';
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            new GameScannerApp();
        });
    </script>
</body>
</html>
